generator client {
  provider   = "prisma-client-js"
  output     = "../generated/prisma"
  engineType = "library"
}

datasource db {
  provider = "postgresql"
}

model Categorie {
  id        Int       @id @default(autoincrement())
  libelle   String    @unique
  produits  Produit[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Produit {
  id           Int                  @id @default(autoincrement())
  libelle      String
  qteStock     Int                  @default(0)
  prixUnitaire Float
  categorieId  Int
  categorie    Categorie            @relation(fields: [categorieId], references: [id])
  ventes       Vente[]
  fournisseurs FournisseurProduit[]
  createdAt    DateTime             @default(now())
  updatedAt    DateTime             @updatedAt

  @@unique([libelle, categorieId])
}

model Vente {
  id           Int      @id @default(autoincrement())
  date         DateTime @default(now())
  quantite     Int
  montantTotal Float
  produitId    Int
  produit      Produit  @relation(fields: [produitId], references: [id])
  createdAt    DateTime @default(now())
}

model Fournisseur {
  id        Int                  @id @default(autoincrement())
  prenom    String
  nom       String
  email     String               @unique
  telephone String?
  adresse   String?
  produits  FournisseurProduit[]
  createdAt DateTime             @default(now())
  updatedAt DateTime             @updatedAt

  @@unique([prenom, nom])
}

// Table de liaison pour Many-to-Many entre Produit et Fournisseur
model FournisseurProduit {
  fournisseurId   Int
  produitId       Int
  fournisseur     Fournisseur @relation(fields: [fournisseurId], references: [id])
  produit         Produit     @relation(fields: [produitId], references: [id])
  prixFournisseur Float? // Prix d'achat spécifique au fournisseur
  delaiLivraison  Int? // Délai de livraison en jours

  @@id([fournisseurId, produitId])
}
